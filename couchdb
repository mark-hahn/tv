#   -*-  grammar-ext: sh  -*-

if [ $(pwd) == "/root/dev/apps/tv" ]; then isdev=true; else isdev=false; fi
if $isdev
  then 
    echo "Running TV in debug mode"
    pkill -f /root/dev/apps/tv/tv-server.js > /dev/null 2>&1
  else 
    echo "Running TV in normal mode"
    pkill -f /root/apps/tv/tv-server.js     > /dev/null 2>&1
fi
killall ffmpeg > /dev/null 2>&1 
killall tail   > /dev/null 2>&1
if $isdev
  then tail -fn 0 ~/logs/tv-dev.log &
  else tail -fn 0 ~/logs/tv.log &
fi
set -e
coffee -co server-js server
rm -f tv-server.js
mv server-js/tv-server.js tv-server.js 
export DEBUG=*
if $isdev
  then nohup node /root/dev/apps/tv/tv-server.js >> ~/logs/tv-dev.log 2>&1 &
  else nohup node     /root/apps/tv/tv-server.js >> ~/logs/tv.log     2>&1 &
fi
