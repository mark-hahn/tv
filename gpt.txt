i undid that because spec changed...

instead of logging lines to tv.log immediately, buffer them and wait until line 238: # file passed all block tests, process it, is reached. then dump buffer to log and start logging live.

after line 299:      log "***********************************************************", is executed clear the buffer and then start buffering again until line 238 is reached.

when app starts don't buffer until line 299 is executed.


you said "While buffering:
if a file gets skipped/blocked/recent/error before passing block tests, its buffered lines are discarded (so they don’t leak into the next flush)."

this is not correct. do not pay attention to any behavior other thsn the requested buffer actions at line 238 and line 299. at 238 you output the buffer to the log and go live. you stay live until line 299 is reached and you start the buffering over again.

currently is retrieves a list of files from the usb server, processes them and then quits.  change it so it doesn't quit but retrieves and processes the files every five minutes. run it in pm2.  whenever it starts processing keep it in buffer mode and ndo ot start live like it does when the app starts.

create a FAST_TEST constant that when true has it process once every 30 secs instead of 5 mins, for testing

i removed an entry form tv-recent and it was not processed.  refresh memory contente of tv-recent.json, and any other in-memory copies of files.
--
only run prune.sh once an hour 

would you recommend switching to use main.js and not use coffeescript any more?

==========================================

tv.log is read and tailed and trimmed by another app.  so no maintenance of tv.log is needed.
--
change name of pm2 process to tv-proc 
-- 
switch from using guessit to using npm module parse-torrent-title. 
-- 
delay starting processing until 5 mins (or 30 secs) have elapsed since finishing last processing
--
sort files by title before processing
--
add server functionality to app to provide an endpoint for a request to a function startProc(title) which takes a title arg and returns {"status":"ok"} for success or {"status":<error msg>} for error.
-- 
startProc() should stop processing while waiting for any single file processing to finish, and then it should trigger a new processing cycle where title is processed first before other files.
--
if there is no title arg or there is no matching file then just restart the cycle
--
use port 3003
--
 the request will come from a browser so handle cors properly 
--
write sample code to a file client.js to run in the browser to call the function with fetch.

==========================================

error: writing tv-errors: {
  reason: "parse-torrent-title: found title but no season/episode (title='SpacedDisc3Extras iso') → not an episode",
  fname: 'SpacedDisc3Extras.iso',
  title: 'SpacedDisc3Extras iso',
  season: undefined,
  episode: undefined,
  usbFilePath: 'Spaced.The.Complete.Series.1999.s1.s2.extras.NTSC.DVD.ISO/SpacedDisc3Extras.iso'
}

==========================================

in addition to writing to tv.log, write and update a file tv.json.  it should contain an array of file objects, one per file. each file object should have these properties when starting download:
status, title, fileSize, season, episode, and the local file path for the file. 
---
the file object should be added with properties: title, fileSize, season, episode, dateStarted, and the local file path for the file, when the file starts downloading. tv.json should be written then.
---
the status should be "downloading" at first.
---
when finished property dateEnded should be added and status changed to "finished". tv.json should be written then.
---
when there is an error the status should be changed to the error message. tv.json should be written then. and processing finished
---
Each change should write the entire file.
---
a file object should be pruned when the date is older than one month.

==========================================

change localPath to "/mnt/media/tv/Cheers/Season 1/" without the filename.
change title to file name: "Cheers.S01E01.Give.Me.a.Ring.Some.Time.1080p.WEB-DL.AAC2.0.H.264-NTb.mkv".
change fileSize to integer number of bytes.
change dates to integer linux timestamps.
---
encrypt the downloading of the actual file.

==========================================

when a cycle that included a download finishes restart a new cycle immediately.  if no download then delay to next cycle.
--
Change delay from 5 mins to 2 mins.

==========================================

add "sequence" number property to object.  it should start with 1 and increment every file. it should reset to 1 on cycle start

==========================================

in file download encrcypt data.  also add progress from 0 to 100 to tv.json object for download

==========================================

add an eta to tv.json object

add endpoint function forceFile(<file title>) that gives <file title> higher priority that any other file when sorting for downloading.  If forceFile is called in the middle of downloading then wait until downloading is finished and then start a new cycle so that <file title> can be downloaded next. if forceFile(<file title>) is called again while old <file title> is downloading then change priority to new <file title>  and restart cycle when current download is finished.


# Force "Chuck" files to be downloaded next
curl "http://localhost:3003/forceFile?title=Chuck"

# POST version
curl -X POST http://localhost:3003/forceFile \
  -H "Content-Type: application/json" \
  -d '{"title":"Chuck"}'