
tv-series-srvr (server) notes
===========================

This client (tv-series-client) talks to tv-series-srvr over WebSocket using a very small RPC protocol.

WebSocket RPC protocol
----------------------

- URL: wss://hahnca.com/tv-series-srvr
- Client implementation: src/srvr.js

Request format (string message)
- "<id>~~~<fname>~~~<param>"
	- id: incrementing integer string from the client
	- fname: RPC function name (examples below)
	- param:
		- if param is an object on the client, it is JSON.stringify(param)
		- if param is a string/number/etc, it is sent as-is

Response format (string message)
- "<id>~~~<status>~~~<result>"
	- status: "ok" for success, anything else means error
	- result: JSON string (the client always JSON.parse(result))

Important: because the client always JSON.parse(result), the server must always JSON.stringify the result,
including when returning strings (return "\"some string\"").

Required RPC endpoints
----------------------

1) setSharedFilters

Purpose
- Stores the current shared filter state in the server so that simple-mode on another computer can use it.

Client usage
- Called when the non-simple mode "Send" button is clicked.
- If UI is in effective "All" mode, the client clears shared filters by calling setSharedFilters(null).

Signature
- fname: setSharedFilters
- param: object OR null

Param payload (object)
- {
		fltrChoice: string,
		filterStr: string,
		condFilters: {
			[condName: string]: number
		}
	}

Rules
- Server should store the object as-is (no transformation required).
- The client forces condFilters.ban = -1; server does not need to enforce it.
- When param is null: clear stored shared filters.

Return
- { ok: true }

2) getSharedFilters

Purpose
- Returns the server-stored shared filter object so simple-mode can show/hide the Custom button and apply it.

Client usage
- Simple-mode polls this every 3 seconds (Buttons component).
- Simple-mode also calls it when Custom is clicked (List.handleButtonClick).

Signature
- fname: getSharedFilters
- param: (ignored / empty)

Return
- If shared filters exist: the stored object (same shape as setSharedFilters payload)
- If none: null

Notes
- The client treats "no shared filters" as null or empty object.

Implementation notes
--------------------

- Keep sharedFilters in memory or persist to disk.
	- Memory-only is simplest but will reset on server restart.
- There are multiple clients (tabs/computers). The simple-mode UI expects:
	- Custom button visible only when getSharedFilters() returns a non-empty object.
	- When sharedFilters changes/clears, the client will turn Custom off and revert to visible button filters.

