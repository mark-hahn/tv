
GAPS LOGIC CHANGES (server)
==========================

Summary
-------
- `data/gaps.json` is treated as a persisted cache of only “shows that currently have gaps”.
- The server prunes entries on load and maintains that invariant on updates.
- The `Waiting` property is considered transient client state and is never persisted or returned.

Files/locations
--------------
- Main implementation is in [index.js](../index.js):
	- `gapEntryHasGap(gap)` predicate
	- startup prune + rewrite of `data/gaps.json`
	- updated `addGap` / `delGap`

What counts as “has a gap”
--------------------------
An entry is kept if ANY of these are true:
- `FileGap === true`
- `WatchGap === true`
- `BlockedGap === true`
- `NotReady === true`
- Any of these are non-null/defined: `FileGapSeason`, `FileGapEpisode`, `WatchGapSeason`, `WatchGapEpisode`
- `WaitStr` is a non-blank string (e.g. `"{3-01}"`)

Note: `Waiting` is NOT used for “has gap” and is removed entirely.

Startup behavior (load + prune)
-------------------------------
- The server loads `data/gaps.json` once at startup into an in-memory map `gaps`.
- During startup it:
	1) Deletes `Waiting` from every gap object (whether true/false).
	2) Deletes any gap entry that does not satisfy `gapEntryHasGap()`.
	3) If anything changed, rewrites `data/gaps.json` with the pruned result.

RPC behavior
------------
- `getGaps`:
	- Returns the in-memory `gaps` object (does NOT reread `data/gaps.json` per call).
	- Returned gap objects do not include `Waiting`.

- `addGap`:
	- Param format: JSON string of `[gapId, gapObj, save]`.
	- Before storing, the server deletes `gapObj.Waiting` (if present).
	- If `gapObj` satisfies `gapEntryHasGap()`, it stores the full object at `gaps[gapId]`.
	- Otherwise it deletes `gaps[gapId]` (so non-gap shows are not persisted).
	- If `save === true`, it writes the entire `gaps` map to `data/gaps.json`.

- `delGap`:
	- Param format: JSON string of `[gapId, save]`.
	- Deletes `gaps[gapId]` (if `gapId !== null`).
	- If `save === true`, writes the entire `gaps` map to `data/gaps.json`.

Persistence
-----------
- The code now uses a shared `gapsPath = 'data/gaps.json'`.
- Writes use `util.writeFile(gapsPath, gaps)` (queued async writer).

